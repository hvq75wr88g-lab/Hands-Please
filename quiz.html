<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breakfast Quiz - Hands Please</title>
  <style>
    :root{
      --eggshell: #f3efe6;
      --ink: #1f2328;
      --accent: #d35400;
      --danger: #c0392b;
      --ok: #27ae60;
    }

    *{ box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body{ height: 100%; overflow: hidden; }

    body{
      background: var(--eggshell);
      background-image: radial-gradient(circle, #ccc 1px, transparent 1px);
      background-size: 20px 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      color: var(--ink);
      display: flex;
      flex-direction: column;
    }

    /* TOP HALF - Questions (50%) */
    .topHalf{
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
    }

    .quizCard{
      width: 100%;
      max-width: 600px;
      background: white;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    .quizHeader{
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 14px;
      font-weight: bold;
      color: #7f8c8d;
    }

    .quizTitle{
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .questionText{
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .choices{
      display: grid;
      gap: 12px;
      margin-bottom: 15px;
    }

    .choice{
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border: 2px solid #ecf0f1;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 16px;
      background: white;
    }

    .choice:hover{
      border-color: var(--accent);
      background: #fff9f0;
      transform: translateX(5px);
    }

    .choice input{
      width: 20px;
      height: 20px;
      accent-color: var(--accent);
    }

    .submitBtn{
      width: 100%;
      padding: 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .submitBtn:hover{ background: #e67e22; }
    .submitBtn:disabled{ opacity: 0.5; cursor: not-allowed; }

    .feedback{
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      min-height: 24px;
    }

    /* BOTTOM HALF - Chicken Show (50%) */
    .bottomHalf{
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      justify-content: space-between;
      padding: 0 30px 30px;
      overflow: visible; /* Changed from hidden to visible */
      background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.3));
    }

    /* Eggs HUD - LEFT SIDE */
    .eggsHUD{
      display: flex;
      flex-direction: column;
      gap: 20px;
      z-index: 20;
      align-items: center;
      margin-bottom: 20px;
    }

    .egg{
      width: 60px;
      height: 75px;
      background: linear-gradient(145deg, #fff, #f0f0f0);
      border: 3px solid #ddd;
      border-radius: 50% 50% 45% 45%;
      box-shadow: 0 6px 0 #ccc, inset 0 2px 0 rgba(255,255,255,0.8);
      position: relative;
      transition: all 0.3s ease;
    }

    .egg::after{
      content: '';
      position: absolute;
      top: 15px;
      left: 15px;
      width: 12px;
      height: 16px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      transform: rotate(-30deg);
    }

    /* REALISTIC CRACK using SVG pattern */
    .egg.cracked{
      background: #e8e8e8;
      border-color: #999;
      transform: rotate(8deg);
      animation: crackShake 0.3s ease-out;
    }

    @keyframes crackShake{
      0%, 100%{ transform: rotate(8deg); }
      25%{ transform: rotate(12deg); }
      50%{ transform: rotate(4deg); }
      75%{ transform: rotate(10deg); }
    }

    .egg.cracked::before{
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background-image:
        /* Main jagged vertical crack */
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 75"><path d="M30 10 L32 18 L28 25 L31 32 L29 40 L32 48 L28 55 L30 65" stroke="%23555" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M30 15 L26 20 M30 22 L34 28 M29 35 L25 38 M31 42 L35 46 M28 52 L24 56" stroke="%23666" stroke-width="1.5" fill="none" stroke-linecap="round"/></svg>');
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.9;
    }

    /* Chicken Stage - RIGHT SIDE */
    .chickenStage{
      flex: 1;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      max-width: 500px;
    }

    .chickenSVG{
      width: 100%;
      height: auto;
      max-height: 95%;
      display: none;
      filter: drop-shadow(0 15px 20px rgba(0,0,0,0.15));
    }

    /* Moods */
    body.happy .happy{ display: block; animation: bounce 0.6s ease-in-out infinite alternate; }
    body.angry .angry{ display: block; animation: shake 0.12s linear infinite; }
    body.wink .wink{ display: block; animation: breathe 3s ease-in-out infinite; }
    body.peck .angry{ display: block; animation: peckAttack 0.5s ease-in-out infinite; }

    @keyframes bounce{
      from{ transform: translateY(0); }
      to{ transform: translateY(-30px); }
    }

    @keyframes shake{
      0%{ transform: translate(2px, 1px) rotate(0deg); }
      25%{ transform: translate(-2px, -2px) rotate(-1deg); }
      50%{ transform: translate(2px, 2px) rotate(1deg); }
      75%{ transform: translate(-2px, 1px) rotate(-1deg); }
      100%{ transform: translate(2px, -1px) rotate(0deg); }
    }

    @keyframes breathe{
      0%, 100%{ transform: scale(1); }
      50%{ transform: scale(1.03); }
    }

    @keyframes peckAttack{
      0%{ transform: scale(1) translateY(0); }
      50%{ transform: scale(1.8) translateY(40px); }
      100%{ transform: scale(1) translateY(0); }
    }

    /* Game Over Popup */
    .gameOverPopup{
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 450px;
      background: white;
      border: 5px solid var(--danger);
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 40px 80px rgba(0,0,0,0.4);
      z-index: 100;
      display: none;
    }

    .gameOverPopup h2{
      font-size: 32px;
      color: var(--danger);
      margin-bottom: 15px;
    }

    .gameOverPopup p{
      font-size: 18px;
      margin-bottom: 10px;
      color: #555;
    }

    .gameOverPopup button{
      margin-top: 20px;
      padding: 16px 40px;
      background: var(--ink);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Admin Link */
    .adminLink{
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 11px;
      color: #95a5a6;
      text-decoration: none;
      background: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 6px;
      z-index: 200;
    }

    .adminLink:hover{ color: var(--accent); }

    /* Admin Modal - FULL EDITOR */
    .adminModal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
      overflow-y: auto;
      padding: 20px;
    }

    .adminPanel{
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 700px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }

    .adminHeader{
      padding: 20px;
      border-bottom: 2px solid #ecf0f1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .adminHeader h2{
      color: var(--accent);
      font-size: 24px;
    }

    .adminBody{
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .adminControls{
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btnAdmin{
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .btnPrimary{ background: var(--accent); color: white; }
    .btnPrimary:hover{ background: #e67e22; }
    .btnSecondary{ background: #ecf0f1; color: var(--ink); }
    .btnSecondary:hover{ background: #d5dbdb; }
    .btnDanger{ background: var(--danger); color: white; }
    .btnDanger:hover{ background: #a93226; }

    .questionsList{
      display: grid;
      gap: 15px;
      margin-bottom: 20px;
    }

    .qCard{
      border: 2px solid #ecf0f1;
      border-radius: 12px;
      padding: 15px;
      background: #fafafa;
    }

    .qCard .qText{
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--ink);
    }

    .qCard .qChoices{
      font-size: 14px;
      color: #555;
      margin-bottom: 10px;
      padding-left: 10px;
    }

    .qCard .qChoices div{
      margin: 5px 0;
    }

    .qCard .qChoices .correct{
      color: var(--ok);
      font-weight: bold;
    }

    .qCard .qActions{
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    /* Editor Form */
    .editorForm{
      display: none;
      background: white;
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .editorForm.active{ display: block; }

    .formField{
      margin-bottom: 15px;
    }

    .formField label{
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
      color: var(--ink);
    }

    .formField input[type="text"],
    .formField textarea{
      width: 100%;
      padding: 10px;
      border: 2px solid #ecf0f1;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    .formField input:focus,
    .formField textarea:focus{
      outline: none;
      border-color: var(--accent);
    }

    .formField textarea{ min-height: 80px; resize: vertical; }

    .choiceEditor{
      display: grid;
      gap: 10px;
    }

    .choiceRow{
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .choiceRow input[type="text"]{
      flex: 1;
      padding: 10px;
      border: 2px solid #ecf0f1;
      border-radius: 8px;
      font-size: 14px;
    }

    .choiceRow input[type="radio"]{
      width: 20px;
      height: 20px;
      accent-color: var(--ok);
    }

    .choiceRow button{
      padding: 8px 12px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .formActions{
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

  </style>
</head>

<body class="wink">

  <!-- TOP HALF -->
  <div class="topHalf">
    <div class="quizCard">
      <div class="quizHeader">
        <span id="qNum">Q 1/9</span>
        <span id="scoreDisplay">Score: 0</span>
      </div>
      
      <div class="quizTitle">Hands Please!</div>
      
      <div class="questionText" id="questionText">Loading...</div>
      
      <div class="choices" id="choicesContainer"></div>
      
      <button class="submitBtn" id="submitBtn">Submit Answer</button>
      
      <div class="feedback" id="feedbackText"></div>
    </div>
  </div>

  <!-- BOTTOM HALF - Split Layout -->
  <div class="bottomHalf">
    
    <!-- LEFT: Eggs -->
    <div class="eggsHUD">
      <div class="egg" id="egg1"></div>
      <div class="egg" id="egg2"></div>
      <div class="egg" id="egg3"></div>
    </div>

    <!-- RIGHT: Chicken Stage -->
    <div class="chickenStage">
      
      <!-- HAPPY (White, Wings Up) -->
      <svg class="chickenSVG happy" viewBox="0 0 400 400" preserveAspectRatio="xMidYMax meet">
        <ellipse cx="200" cy="260" rx="100" ry="105" fill="#ffffff" stroke="#222" stroke-width="6"/>
        <path d="M110 210 Q60 120 90 100" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round"/>
        <path d="M110 210 Q60 120 90 100" fill="none" stroke="#222" stroke-width="5" stroke-linecap="round"/>
        <path d="M290 210 Q340 120 310 100" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round"/>
        <path d="M290 210 Q340 120 310 100" fill="none" stroke="#222" stroke-width="5" stroke-linecap="round"/>
        <path d="M170 350 L165 380 M230 350 L235 380" stroke="#f39c12" stroke-width="10" stroke-linecap="round"/>
        <circle cx="200" cy="160" r="70" fill="#fff" stroke="#222" stroke-width="6"/>
        <path d="M170 110 Q200 70 230 110" fill="#e74c3c" stroke="#222" stroke-width="5"/>
        <path d="M175 150 Q185 140 195 150 M205 150 Q215 140 225 150" fill="none" stroke="#222" stroke-width="5" stroke-linecap="round"/>
        <path d="M185 175 Q200 190 215 175" fill="none" stroke="#f39c12" stroke-width="5" stroke-linecap="round"/>
      </svg>

      <!-- ANGRY (Brown, Rage) -->
      <svg class="chickenSVG angry" viewBox="0 0 400 400" preserveAspectRatio="xMidYMax meet">
        <ellipse cx="200" cy="260" rx="110" ry="100" fill="#8B4513" stroke="#222" stroke-width="6"/>
        <path d="M70 220 Q30 200 50 270" fill="#A0522D" stroke="#222" stroke-width="5"/>
        <path d="M330 220 Q370 200 350 270" fill="#A0522D" stroke="#222" stroke-width="5"/>
        <path d="M170 350 L165 380 M230 350 L235 380" stroke="#f39c12" stroke-width="10" stroke-linecap="round"/>
        <circle cx="200" cy="150" r="68" fill="#8B4513" stroke="#222" stroke-width="6"/>
        <path d="M175 95 L182 75 L189 95 L196 75 L203 95 L210 75 L217 95" fill="#e74c3c" stroke="#222" stroke-width="3"/>
        <path d="M160 130 L185 145 M240 130 L215 145" stroke="#222" stroke-width="6" stroke-linecap="round"/>
        <circle cx="175" cy="150" r="5" fill="#ff0000"/>
        <circle cx="225" cy="150" r="5" fill="#ff0000"/>
        <path d="M185 170 L215 170 L200 190 Z" fill="#f39c12" stroke="#222" stroke-width="4"/>
      </svg>

      <!-- WINK (Tan, Chill) -->
      <svg class="chickenSVG wink" viewBox="0 0 400 400" preserveAspectRatio="xMidYMax meet">
        <ellipse cx="200" cy="260" rx="95" ry="100" fill="#DEB887" stroke="#222" stroke-width="6"/>
        <path d="M115 250 Q95 270 125 285" fill="none" stroke="#CD853F" stroke-width="6" stroke-linecap="round"/>
        <path d="M170 350 L170 380 M230 350 L230 380" stroke="#f39c12" stroke-width="10" stroke-linecap="round"/>
        <circle cx="200" cy="150" r="65" fill="#DEB887" stroke="#222" stroke-width="6"/>
        <path d="M170 100 Q200 70 230 100" fill="#e74c3c" stroke="#222" stroke-width="5"/>
        <circle cx="175" cy="145" r="6" fill="#222"/>
        <path d="M210 145 Q220 150 230 145" fill="none" stroke="#222" stroke-width="5" stroke-linecap="round"/>
        <path d="M185 170 L215 170 L200 185 Z" fill="#f39c12" stroke="#222" stroke-width="4"/>
      </svg>

    </div>
  </div>

  <!-- Game Over Popup -->
  <div class="gameOverPopup" id="gameOverPopup">
    <h2>Strike 3!</h2>
    <p>Oh oh! The chicken is NOT happy.</p>
    <p>Study hard and try again!</p>
    <button onclick="location.reload()">Restart Quiz</button>
  </div>

  <a href="#" class="adminLink" onclick="event.preventDefault(); openAdmin();">Admin</a>

  <!-- Admin Modal with FULL EDITOR -->
  <div class="adminModal" id="adminModal">
    <div class="adminPanel">
      
      <div class="adminHeader">
        <h2>Question Bank Editor</h2>
        <button class="btnSecondary" onclick="closeAdmin()">Close</button>
      </div>

      <div class="adminBody">
        
        <div class="adminControls">
          <button class="btnPrimary" onclick="showAddForm()">‚ûï Add New Question</button>
          <button class="btnSecondary" onclick="resetToDefaults()">Reset to Defaults</button>
          <button class="btnSecondary" onclick="exportQuestions()">Export JSON</button>
          <button class="btnSecondary" onclick="importQuestions()">Import JSON</button>
        </div>

        <!-- Editor Form (Hidden by default) -->
        <div class="editorForm" id="editorForm">
          <h3 style="margin-bottom:15px; color:var(--accent);">Edit Question</h3>
          
          <div class="formField">
            <label>Question Text:</label>
            <textarea id="editQuestionText" placeholder="Enter your question..."></textarea>
          </div>

          <div class="formField">
            <label>Answer Choices (check the correct one):</label>
            <div class="choiceEditor" id="choiceEditor">
              <!-- Dynamic choice rows -->
            </div>
            <button class="btnSecondary" onclick="addChoiceRow()" style="margin-top:10px; padding:8px 12px; font-size:13px;">+ Add Choice</button>
          </div>

          <div class="formActions">
            <button class="btnPrimary" onclick="saveQuestion()">Save Question</button>
            <button class="btnSecondary" onclick="cancelEdit()">Cancel</button>
            <button class="btnDanger" onclick="deleteCurrentQuestion()" id="deleteBtn" style="display:none;">Delete Question</button>
          </div>
        </div>

        <!-- Questions List -->
        <div class="questionsList" id="questionsList"></div>

      </div>
    </div>
  </div>

  <script>
    // === DATA ===
    const DEFAULT_BANK = [
      { id: '1', q: "Describe Loop juices to a guest:", c: ["Imperfect produce, cold pressed, circular economy", "Fresh squeezed daily in-house", "Concentrate from cartons"], a: 0 },
      { id: '2', q: "Is the Farmhouse Breakfast gluten free?", c: ["Yes, it's naturally gluten free", "No - potatoes cooked in shared fryer (cross-contamination)", "Only if you remove the eggs"], a: 1 },
      { id: '3', q: "What can VEGAN guests eat?", c: ["Farmhouse Breakfast (no eggs)", "Vegan Mexican Scramble or Fruit Plate", "Eggs Benedict (hold hollandaise)"], a: 1 },
      { id: '4', q: "What's in the Power Bowl?", c: ["Oatmeal with brown sugar", "Greek yogurt, berries, granola, smoothie, fresh fruit", "Acai blend with granola"], a: 1 },
      { id: '5', q: "Components of Avocado Toast:", c: ["Sourdough, smashed avo, poached eggs, radish, pickled onion, feta", "Rye bread, fried egg, bacon", "Gluten free toast, plain avocado"], a: 0 },
      { id: '6', q: "Is the Oatmeal gluten free?", c: ["Yes, certified gluten free", "Cooked in water but NOT celiac-safe (trace risk)", "Only if ordered plain"], a: 1 },
      { id: '7', q: "Belgian Waffle comes with:", c: ["Just butter and syrup", "Fresh berries, maple whipped cream, salted caramel, icing sugar", "Chocolate sauce and banana"], a: 1 },
      { id: '8', q: "Dairy-free options:", c: ["Pancakes with butter", "Fruit Plate, Vegan Scramble, Oatmeal (water-cooked)", "Yogurt Bowl"], a: 1 },
      { id: '9', q: "Can Celiac guests have potatoes/fries?", c: ["Yes, totally safe", "No - cooked in shared fryer with gluten items", "Only baked potatoes"], a: 1 }
    ];

    // === STATE ===
    let questions = [];
    let currentIdx = 0;
    let score = 0;
    let strikes = 0;
    let gameOver = false;
    let editingId = null;

    // === INIT ===
    function init(){
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      questions = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      
      // Ensure IDs exist
      questions.forEach((q, i) => {
        if(!q.id) q.id = 'q' + Date.now() + i;
      });
      
      // Shuffle slightly
      questions.sort(() => Math.random() - 0.5);
      
      // Reset
      currentIdx = 0;
      score = 0;
      strikes = 0;
      gameOver = false;
      
      document.body.className = 'wink';
      document.getElementById('gameOverPopup').style.display = 'none';
      document.querySelectorAll('.egg').forEach(e => e.className = 'egg');
      
      renderQuestion();
    }

    // === RENDER QUIZ ===
    function renderQuestion(){
      if(currentIdx >= questions.length){
        finishQuiz(true);
        return;
      }

      const q = questions[currentIdx];

      document.getElementById('qNum').innerText = `Q ${currentIdx + 1}/${questions.length}`;
      document.getElementById('scoreDisplay').innerText = `Score: ${score}`;
      document.getElementById('questionText').innerText = q.q;
      document.getElementById('feedbackText').innerText = '';

      const container = document.getElementById('choicesContainer');
      container.innerHTML = '';

      q.c.forEach((choice, i) => {
        const label = document.createElement('label');
        label.className = 'choice';
        label.innerHTML = `<input type="radio" name="answer" value="${i}"> ${choice}`;
        container.appendChild(label);
      });

      if(!gameOver) setMood('wink');
    }

    // === SUBMIT ===
    document.getElementById('submitBtn').onclick = () => {
      if(gameOver) return;

      const selected = document.querySelector('input[name="answer"]:checked');
      if(!selected){
        document.getElementById('feedbackText').innerText = 'üëÜ Pick an answer!';
        document.getElementById('feedbackText').style.color = '#e67e22';
        return;
      }

      const answer = parseInt(selected.value);
      const correct = questions[currentIdx].a;

      if(answer === correct){
        // CORRECT
        score++;
        document.getElementById('feedbackText').innerText = '‚úÖ Correct!';
        document.getElementById('feedbackText').style.color = 'var(--ok)';
        setMood('happy');

        setTimeout(() => {
          currentIdx++;
          renderQuestion();
        }, 1200);

      } else {
        // WRONG
        strikes++;
        document.getElementById('feedbackText').innerText = '‚ùå Wrong!';
        document.getElementById('feedbackText').style.color = 'var(--danger)';
        setMood('angry');

        // Crack egg
        if(strikes <= 3){
          document.getElementById(`egg${strikes}`).classList.add('cracked');
        }

        if(strikes >= 3){
          setTimeout(() => finishQuiz(false), 1000);
        } else {
          setTimeout(() => {
            currentIdx++;
            renderQuestion();
          }, 1200);
        }
      }
    };

    // === MOODS ===
    function setMood(mood){
      document.body.className = mood;
    }

    // === FINISH ===
    function finishQuiz(win){
      gameOver = true;
      document.getElementById('submitBtn').disabled = true;

      if(win){
        document.getElementById('questionText').innerText = 'üéâ Quiz Complete! Great Job!';
        setMood('happy');
      } else {
        // STRIKE 3
        setMood('peck');
        document.getElementById('gameOverPopup').style.display = 'block';
      }
    }

    // === ADMIN ===
    function openAdmin(){
      const pw = prompt('Enter admin password:');
      if(pw === 'Iworkfortips'){
        document.getElementById('adminModal').style.display = 'flex';
        renderQuestionsList();
      } else if(pw !== null){
        alert('Incorrect password');
      }
    }

    function closeAdmin(){
      document.getElementById('adminModal').style.display = 'none';
      cancelEdit();
    }

    function renderQuestionsList(){
      const list = document.getElementById('questionsList');
      list.innerHTML = '';

      // Reload from storage
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      const bank = stored ? JSON.parse(stored) : [...DEFAULT_BANK];

      bank.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'qCard';
        
        let choicesHTML = '';
        q.c.forEach((choice, i) => {
          const cls = i === q.a ? 'correct' : '';
          const mark = i === q.a ? '‚úì' : '';
          choicesHTML += `<div class="${cls}">${i+1}. ${choice} ${mark}</div>`;
        });

        card.innerHTML = `
          <div class="qText">${idx+1}. ${q.q}</div>
          <div class="qChoices">${choicesHTML}</div>
          <div class="qActions">
            <button class="btnSecondary" onclick="editQuestion('${q.id}')">Edit</button>
            <button class="btnDanger" onclick="deleteQuestion('${q.id}')">Delete</button>
          </div>
        `;
        
        list.appendChild(card);
      });
    }

    function showAddForm(){
      editingId = null;
      document.getElementById('deleteBtn').style.display = 'none';
      document.getElementById('editQuestionText').value = '';
      document.getElementById('choiceEditor').innerHTML = '';
      
      // Add 3 blank choices
      for(let i = 0; i < 3; i++){
        addChoiceRow();
      }

      document.getElementById('editorForm').classList.add('active');
    }

    function addChoiceRow(){
      const editor = document.getElementById('choiceEditor');
      const idx = editor.children.length;
      
      const row = document.createElement('div');
      row.className = 'choiceRow';
      row.innerHTML = `
        <input type="radio" name="correctChoice" value="${idx}" ${idx === 0 ? 'checked' : ''}>
        <input type="text" placeholder="Choice ${idx + 1}" data-choice-idx="${idx}">
        <button onclick="removeChoiceRow(this)">‚úï</button>
      `;
      
      editor.appendChild(row);
    }

    function removeChoiceRow(btn){
      const row = btn.parentElement;
      if(document.getElementById('choiceEditor').children.length > 2){
        row.remove();
        // Re-index
        document.querySelectorAll('[data-choice-idx]').forEach((input, i) => {
          input.setAttribute('data-choice-idx', i);
          input.previousElementSibling.value = i;
        });
      } else {
        alert('Must have at least 2 choices');
      }
    }

    function editQuestion(id){
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      const bank = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      const q = bank.find(x => x.id === id);
      
      if(!q) return;

      editingId = id;
      document.getElementById('deleteBtn').style.display = 'inline-block';
      document.getElementById('editQuestionText').value = q.q;
      
      const editor = document.getElementById('choiceEditor');
      editor.innerHTML = '';
      
      q.c.forEach((choice, i) => {
        const row = document.createElement('div');
        row.className = 'choiceRow';
        row.innerHTML = `
          <input type="radio" name="correctChoice" value="${i}" ${i === q.a ? 'checked' : ''}>
          <input type="text" value="${choice}" data-choice-idx="${i}">
          <button onclick="removeChoiceRow(this)">‚úï</button>
        `;
        editor.appendChild(row);
      });

      document.getElementById('editorForm').classList.add('active');
    }

    function saveQuestion(){
      const qText = document.getElementById('editQuestionText').value.trim();
      if(!qText){
        alert('Question text required');
        return;
      }

      const choices = [];
      document.querySelectorAll('[data-choice-idx]').forEach(input => {
        const val = input.value.trim();
        if(val) choices.push(val);
      });

      if(choices.length < 2){
        alert('Need at least 2 choices');
        return;
      }

      const correctRadio = document.querySelector('input[name="correctChoice"]:checked');
      const correctIdx = correctRadio ? parseInt(correctRadio.value) : 0;

      const stored = localStorage.getItem('handsPlease_quiz_v5');
      let bank = stored ? JSON.parse(stored) : [...DEFAULT_BANK];

      if(editingId){
        // Update existing
        bank = bank.map(q => {
          if(q.id === editingId){
            return { id: q.id, q: qText, c: choices, a: correctIdx };
          }
          return q;
        });
      } else {
        // Add new
        bank.push({
          id: 'q' + Date.now(),
          q: qText,
          c: choices,
          a: correctIdx
        });
      }

      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(bank));
      
      renderQuestionsList();
      cancelEdit();
    }

    function cancelEdit(){
      document.getElementById('editorForm').classList.remove('active');
      editingId = null;
    }

    function deleteCurrentQuestion(){
      if(!editingId) return;
      if(!confirm('Delete this question?')) return;
      deleteQuestion(editingId);
      cancelEdit();
    }

    function deleteQuestion(id){
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      let bank = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      
      bank = bank.filter(q => q.id !== id);
      
      localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(bank));
      renderQuestionsList();
    }

    function resetToDefaults(){
      if(confirm('Reset all questions to defaults?')){
        localStorage.removeItem('handsPlease_quiz_v5');
        location.reload();
      }
    }

    function exportQuestions(){
      const stored = localStorage.getItem('handsPlease_quiz_v5');
      const bank = stored ? JSON.parse(stored) : [...DEFAULT_BANK];
      const json = JSON.stringify(bank, null, 2);
      
      navigator.clipboard.writeText(json).then(() => {
        alert('Questions copied to clipboard!');
      }).catch(() => {
        prompt('Copy this JSON:', json);
      });
    }

    function importQuestions(){
      const json = prompt('Paste question bank JSON:');
      if(!json) return;
      
      try{
        const parsed = JSON.parse(json);
        if(!Array.isArray(parsed)) throw new Error('Not an array');
        
        localStorage.setItem('handsPlease_quiz_v5', JSON.stringify(parsed));
        alert('Questions imported successfully!');
        renderQuestionsList();
      } catch(e){
        alert('Invalid JSON: ' + e.message);
      }
    }

    // === START ===
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
